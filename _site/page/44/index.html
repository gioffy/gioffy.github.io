<!DOCTYPE HTML>

<html lang="it-IT">

<head>
	<meta charset="utf-8">
	<title>Giorgio Formica</title>
	<meta name="author" content="Giorgio Formica">
	
	<meta name="description" content="
		Giorgio Formica's Blog
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="http://feeds.feedburner.com/Gioffy" rel="alternate" title="Giorgio Formica" type="application/atom+xml">
	
	<link rel="canonical" href="http://gioffy.github.io/page/44/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	
  	
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-18516027-1']);
		
		
      _gaq.push(['_setDomainName','.gioffy.com']);
		
		
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>





</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<img src="https://2.gravatar.com/avatar/8948c057447f75653fa747229189cdb9?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<hgroup>
  <h1><a href="/">Giorgio Formica</a></h1>
  
    <h2>The other one.</h2>
  
</hgroup>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about/">about</a></li>
  <li><a href="/archive">archives</a></li>
  <li><a href="/tags">tags</a></li>
  <li><a href="https://github.com/imperugo/feedback/issues/new">contact</a></li>
</ul>


<section class="aboutme">
  <p>
    Giorgio Formica's Blog
  </p>
</section>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
			<a class="twitter" href="http://twitter.com/gioffy" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/gioffy" title="GitHub">GitHub</a>
		
		
			<a class="rss" href="http://feeds.feedburner.com/Gioffy" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/2009/05/19/visual-studio-2010-e-net-framework-4-0/" itemprop="url">Visual Studio 2010 e .NET Framework 4.0</a></h1>
	<div class="meta">
	<span class="date">



  


<time datetime="2009-05-19T12:51:52Z"  itemprop="datePublished">May 19, 2009</time></span>
	<span class="categories">.net</span>
	
		
  


<span class="comments"><a href="/2009/05/19/visual-studio-2010-e-net-framework-4-0/#disqus_thread">comments</a></span>
	
	<span class="edit">
  


<a href="https://github.com/gioffy/gioffy.github.io/edit/gh-pages/_posts/2009-05-19-visual-studio-2010-e-net-framework-4-0.markdown">edit</a>
</span>
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Gi&agrave; dalla presentazione alla <strong><a target="_blank" href="http://www.microsoftpdc.com/Default.aspx">PDC</a> di Los Angeles</strong> se ne parla molto e da ieri, per i possessori di un abbonamento MSDN, &egrave; possibile scaricare la <strong>Beta1</strong> del <strong>.NET Framework 4.0</strong> e <strong>Visual Studio 2010</strong>.</p>

<p>Ovviamente le novit&agrave; sono tantissime, a partire dal tool di sviluppo che include nuove e numerosissime migliorie, fino ad arrivare ad <strong>ASP.NET</strong> passando per il totalmente nuovo <strong>WorkFlow</strong> e <strong>Windows Communication Foundation</strong> che sar&agrave; sempre pi&ugrave; presente nel mondo dello sviluppatore.</p>

<p>Partendo da <strong>Visual Studio</strong> la prima cosa che salta all&rsquo;occhio &egrave; sicuramente l&rsquo;interfaccia migliorata come testimoniano gli screenshot seguenti:</p>

<p><a href="http://imperugo.tostring.it/Content/Uploaded/image/001_4.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="123" border="0" title="001" alt="001" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/001_thumb_1.png" /></a> <a href="http://imperugo.tostring.it/Content/Uploaded/image/002_2.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="123" border="0" title="002" alt="002" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/002_thumb.png" /></a> <a href="http://imperugo.tostring.it/Content/Uploaded/image/003_2.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="123" border="0" title="003" alt="003" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/003_thumb.png" /></a>&nbsp;<a href="http://imperugo.tostring.it/Content/Uploaded/image/004_2.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="124" border="0" title="004" alt="004" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/004_thumb.png" /></a>&nbsp; <a href="http://imperugo.tostring.it/Content/Uploaded/image/006_2.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="123" border="0" title="006" alt="006" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/006_thumb.png" /></a> <a href="http://imperugo.tostring.it/Content/Uploaded/image/010_2.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="123" border="0" title="010" alt="010" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/010_thumb.png" /></a> <a href="http://imperugo.tostring.it/Content/Uploaded/image/007_2.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="124" border="0" title="007" alt="007" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/007_thumb.png" /></a> <a href="http://imperugo.tostring.it/Content/Uploaded/image/008_2.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="123" border="0" title="008" alt="008" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/008_thumb.png" /></a>&nbsp;<a href="http://imperugo.tostring.it/Content/Uploaded/image/009_2.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="123" border="0" title="009" alt="009" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/009_thumb.png" /></a> <a href="http://imperugo.tostring.it/Content/Uploaded/image/005_4.png" rel="shadowbox[Visual-Studio-2010-e-NET-Framework-40];options={counterType:'skip',continuous:true,animSequence:'sync'}"><img SinglelineIgnoreCase width="204" height="123" border="0" title="005" alt="005" style="border: 0px none ; display: inline;" src="http://imperugo.tostring.it/Content/Uploaded/image/005_thumb_1.png" /></a></p>

<p>Anche il designer di <strong>WPF</strong> e <strong>Workflow</strong> &egrave; totalmente nuovo e potenziato; inoltre &egrave; stato aggiunto il supporto per i diagrammi <strong>UML</strong> per la versiose Architect e TeamSystem e nello specifico per i seguenti diagrammi:</p>

<ul>
    <li><strong>Activity</strong>;</li>
    <li><strong>Use Case</strong>;</li>
    <li><strong>Component</strong>;</li>
    <li><strong>Sequence</strong>;</li>
    <li><strong>Class</strong>;</li>
</ul>

<p>Interessante l&rsquo;introduzione di un designer (che <strong>sfrutta WorkFlow 4.0</strong> con delle custom activity) per la <strong>customizzazioni di Build</strong>.</p>

<p>Altre novit&agrave; di Visual Studio 2010 le trovate in <a target="_blank" href="http://channel9.msdn.com/pdc2008/TL47/">questo video</a>.</p>

<p><b>ASP.NET 4.0</b>:</p>

<ul>
    <li>Possibilit&agrave; di specificare <b>providers custom per la gestione della cache</b>;</li>
    <li><strong>AutoStart</strong> delle applicazione web;</li>
    <li>Aggiunto il metodo per il <strong>Permanent Redirect</strong> (301);</li>
    <li>Aggiunte le Propriet&agrave; <strong>Keywords</strong> e <strong>Description</strong> all&rsquo;oggetto <strong>Page</strong>;</li>
    <li>Possibilit&agrave; di <strong>abilitare il ViewState per il singolo controllo</strong> ignorando la direttiva ViewState della pagina;</li>
    <li>Introdotto il<strong> Routing come in ASP.NET MVC</strong>;</li>
    <li>Possibilit&agrave; di <strong>intervenire sul ClientID dei controlli</strong>;</li>
    <li>Migliorata l&rsquo;<strong>integrazione con la libreria Javascript JQuery</strong>;</li>
    <li>Migliorato il <strong>supporto per i CSS e Javascript</strong>;</li>
    <li>Aggiunta la possibilit&agrave; di <strong>inserire snippet anche nel markup</strong>;</li>
    <li>&Eacute; stato introdotto un nuovo meccanismo di deploy che consente la trasformazione del file di configurazione tramite <strong>XDT (XML Document Transform)</strong>;</li>
    <li>&Egrave; stato introdotto il <strong>Web Packaging</strong> che permette di creare un file di installazione con tutto il necessario per il corretto funzionamento della nostra applicazione web;</li>
</ul>

<p>Maggiori informazioni sulle novit&agrave; di <b>ASP.NET 4.0</b> sono disponibili <a target="_blank" href="http://www.asp.net/learn/whitepapers/aspnet40/">qui</a> ed un video introduttivo sulle novit&agrave; <a target="_blank" href="http://channel9.msdn.com/pdc2008/PC20/">qui</a>.</p>

<p>&nbsp;</p>

<p><strong>ENTITY FRAMEWORK: </strong></p>

<ul>
    <li>La tanto richiesta <b>Persistance Ignorance</b>;</li>
    <li>Il <b>LazyLoad</b>;</li>
    <li>Possibilit&agrave; di utilizzare il <b>tool grafico per il mapping partendo da un dominio esistente</b>;</li>
    <li>Migliorata la <b>stabilit&agrave; del designer;</b></li>
    <li>Aggiunta la possibilit&agrave; di <b>mappare stored procedure su entit&agrave; custom</b>;</li>
</ul>

<p>Per maggiori informazioni sulle novit&agrave; di <b>EntityFramework</b> consiglio di seguire il blog del team <a target="_blank" href="http://blogs.msdn.com/efdesign/">qui</a> ed un video sulle principali novit&agrave; <a target="_blank" href="http://channel9.msdn.com/pdc2008/TL20/">qui</a>.</p>

<p>&nbsp;</p>

<p><strong>WINDOWS COMMUNICATION FOUNDATION:</strong></p>

<ul>
    <li>Migliorate le performance del <b>DataContractSerializer</b>;</li>
    <li><b>Semplificazione della configurazione</b>;</li>
    <li><b>Autoconfigurazione dei file svc</b>;</li>
    <li>Aggiunto il binding <b>HTTP Pooling Duplex</b>, utilizzato da <b>Silverlight</b>;</li>
    <li>Possibilit&agrave; di <b>esporre un servizio sul protocollo UDP</b>;</li>
    <li>Routing (precedentemente incluso su Dublin);</li>
    <li>REST&nbsp;Caching;</li>
    <li>Hosting in IIS senza SVC;</li>
    <li>Discovery dei servizi;</li>
    <li>Nuovo sistema di <b>Claim</b> basato su <b>Geneva</b> (nuovo framework per l'autenticazione e gestione dell'identit&agrave;, maggiori info le trovate <a target="_blank" href="http://blogs.ugidotnet.org/raffaele/archive/2009/05/13/geneva-beta-2-finalmente-disponibile.aspx">qui</a>);</li>
    <li>Aggiunto il routing, utile per dirottare chiamate verso diversi endpoint;</li>
</ul>

<p>Maggiori informazioni sulle novit&agrave; di WCF le trovate <a target="_blank" href="http://msdn.microsoft.com/en-us/library/ee354381.aspx">qui</a> ed un video sulle novit&agrave; <a target="_blank" href="http://channel9.msdn.com/pdc2008/TL06/">qui</a>.</p>

<p><br />
<strong>WORKFLOW:</strong></p>

<ul>
    <li>Totalmente riscritto;</li>
    <li>MIgliorate le performarce;</li>
    <li>Nuova Activity Library con il supporto per le collection;</li>
    <li>Nuovo WorkFlow chiamato FlowChart;</li>
    <li>Nuovo e pi&ugrave; potente designer integrato in Visual Studio 2010;</li>
    <li>Maggior integrazione con WCF;</li>
</ul>

<p>Maggiori informazioni le trovate <a target="_blank" href="http://blogs.aspitalia.com/cradle/post2501/.NET-Framework-4.0-Beta-1-Workflow-Foundation-4.0.aspx">qui</a> ed un video introduttivo su WorkFlow 4.0 <a target="_blank" href="http://channel9.msdn.com/pdc2008/TL17/">qui</a>.</p>

<p>Da annotare che nella Beta non &egrave; presente il Framework <a target="_blank" href="http://www.asp.net/mvc">ASP.NET MVC</a> come spiegato da <a target="_blank" href="http://haacked.com/">Phil Haack</a>&nbsp;<a target="_blank" href="http://haacked.com/archive/2009/05/18/aspnetmvc-vs2010-beta1.aspx">qui</a>.</p>

<p>Ciauz</p>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/2009/05/18/problema-con-nhibernate-e-table-for-hierarchy/" itemprop="url">Problema con NHibernate e Table for Hierarchy</a></h1>
	<div class="meta">
	<span class="date">



  


<time datetime="2009-05-18T09:55:12Z"  itemprop="datePublished">May 18, 2009</time></span>
	<span class="categories">orm</span>
	
		
  


<span class="comments"><a href="/2009/05/18/problema-con-nhibernate-e-table-for-hierarchy/#disqus_thread">comments</a></span>
	
	<span class="edit">
  


<a href="https://github.com/gioffy/gioffy.github.io/edit/gh-pages/_posts/2009-05-18-problema-con-nhibernate-e-table-for-hierarchy.markdown">edit</a>
</span>
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Tempo fa, insieme a <a href="http://blogs.aspitalia.com/cradle" target="_blank">Marco</a>, mi sono imbattuto in un problema relativo al fetching di collection polimorfiche tramite <a href="https://www.hibernate.org/343.html" target="_blank">NHibernate</a>.</p>  <p>In pratica, quando si hanno <strong>collection il cui tipo contenuto eredita da un’altra entity persistita tramite Table for Hierarchy</strong> (maggiori info <a href="http://nhforge.org/doc/nh/en/index.html#inheritance-tableperclass" target="_blank">qui</a>) , si possono riscontrare dei problemi in fase di fetching quando la collection è contenuta in una entity parent.     <br />Per capire meglio il significato di quanto appena detto si osservi il diagramma di classe seguente:</p>  <p><a href="http://imperugo.tostring.it/Content/Uploaded/image/Diagramma_1.png" rel="shadowbox"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Diagramma" border="0" alt="Diagramma" src="http://imperugo.tostring.it/Content/Uploaded/image/Diagramma_thumb_1.png" width="262" height="346" /></a> </p>  <p>Per la situazione sopra descritta si avrà un mapping come il seguente:</p>  <pre class="brush: xml; ruler: true;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;hibernate-mapping
    schema=&quot;dbo&quot;
    xmlns=&quot;urn:nhibernate-mapping-2.2&quot;
    default-access=&quot;property&quot;
    namespace=&quot;ConsoleApplication1.ObjectModel&quot;
    assembly=&quot;ConsoleApplication1&quot;&gt;

    &lt;class name=&quot;Post&quot; table=&quot;Posts&quot; lazy=&quot;true&quot; dynamic-update=&quot;true&quot;&gt;
        &lt;id name=&quot;ID&quot; column=&quot;ID&quot; unsaved-value=&quot;0&quot;&gt;
            &lt;generator class=&quot;identity&quot;/&gt;
        &lt;/id&gt;
        &lt;property name=&quot;Title&quot;&gt;
            &lt;column name=&quot;Title&quot; sql-type=&quot;nvarchar(100)&quot; not-null=&quot;true&quot; /&gt;
        &lt;/property&gt;
    &lt;bag name=&quot;PostTags&quot; cascade=&quot;all-delete-orphan&quot; generic=&quot;true&quot;&gt;
            &lt;key column=&quot;PostID&quot; /&gt;
            &lt;one-to-many class=&quot;PostTag&quot; /&gt;
        &lt;/bag&gt;
    &lt;bag name=&quot;ImageTags&quot; cascade=&quot;all-delete-orphan&quot; generic=&quot;true&quot;&gt;
      &lt;key column=&quot;PostID&quot; /&gt;
      &lt;one-to-many class=&quot;ImageTag&quot; /&gt;
    &lt;/bag&gt;
    &lt;/class&gt;
    
&lt;/hibernate-mapping&gt;</pre>

<p>&#160;</p>

<pre class="brush: xml; ruler: true;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;hibernate-mapping
    schema=&quot;dbo&quot;
    xmlns=&quot;urn:nhibernate-mapping-2.2&quot;
    default-access=&quot;property&quot;
    namespace=&quot;ConsoleApplication1.ObjectModel&quot;
    assembly=&quot;ConsoleApplication1&quot;&gt;

    &lt;class name=&quot;TagBase&quot; table=&quot;Tags&quot; lazy=&quot;true&quot; dynamic-update=&quot;true&quot;&gt;
        &lt;id name=&quot;ID&quot; column=&quot;ID&quot; unsaved-value=&quot;0&quot;&gt;
            &lt;generator class=&quot;identity&quot;/&gt;
        &lt;/id&gt;
    &lt;discriminator force=&quot;true&quot;&gt;
      &lt;column name=&quot;Discriminator&quot; not-null=&quot;true&quot;  sql-type=&quot;int&quot; /&gt;
    &lt;/discriminator&gt;
        &lt;property name=&quot;Name&quot;&gt;
            &lt;column name=&quot;Name&quot; sql-type=&quot;nvarchar(100)&quot; not-null=&quot;true&quot; /&gt;
        &lt;/property&gt;
    &lt;/class&gt;
    
&lt;/hibernate-mapping&gt;</pre>

<p>&#160;</p>

<pre class="brush: xml; ruler: true;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;hibernate-mapping
    schema=&quot;dbo&quot;
    xmlns=&quot;urn:nhibernate-mapping-2.2&quot;
    default-access=&quot;property&quot;
    namespace=&quot;ConsoleApplication1.ObjectModel&quot;
    assembly=&quot;ConsoleApplication1&quot;&gt;

    &lt;subclass name=&quot;ImageTag&quot; extends=&quot;TagBase&quot; discriminator-value=&quot;1&quot; &gt;
    &lt;/subclass&gt;
    
&lt;/hibernate-mapping&gt;</pre>

<p>&#160;</p>

<pre class="brush: xml; ruler: true;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;hibernate-mapping
    schema=&quot;dbo&quot;
    xmlns=&quot;urn:nhibernate-mapping-2.2&quot;
    default-access=&quot;property&quot;
    namespace=&quot;ConsoleApplication1.ObjectModel&quot;
    assembly=&quot;ConsoleApplication1&quot;&gt;

    &lt;subclass name=&quot;PostTag&quot; extends=&quot;TagBase&quot; discriminator-value=&quot;0&quot;&gt;
    &lt;/subclass&gt;
    
&lt;/hibernate-mapping&gt;</pre>

<p>Se si tenta di recuperare una collection di <strong>PostTag</strong> non si riscontrano problemi; al contrario, se si tenta di recuperare un’istanza della classe <strong>Post</strong> e, allo stesso tempo, la collection PostTag ad esso associata, si andrà incontro ad un’eccezione. 

  <br />Per ovviare al problema basta inserire nel mapping della collection la where con il discriminator, come mostrato di seguito:</p>

<pre class="brush: xml; ruler: true;">&lt;bag name=&quot;PostTags&quot; cascade=&quot;all-delete-orphan&quot; generic=&quot;true&quot; where=&quot;Discriminator = 0&quot;&gt;
    &lt;key column=&quot;PostID&quot; /&gt;
    &lt;one-to-many class=&quot;PostTag&quot; /&gt;
&lt;/bag&gt;
&lt;bag name=&quot;ImageTags&quot; cascade=&quot;all-delete-orphan&quot; generic=&quot;true&quot; where=&quot;Discriminator = 1&quot;&gt;
    &lt;key column=&quot;PostID&quot; /&gt;
    &lt;one-to-many class=&quot;ImageTag&quot; /&gt;
&lt;/bag&gt;</pre>

<p>Questo comportamento, pur essendo documentato dal team di Nhibernate <a href="https://www.hibernate.org/407.html#A14" target="_blank">qui</a>, resta comunque strano. 

  <br />Un’altra soluzione, sicuramente più comoda e mantenibile, consiste nell’impostare l’attributo force del discriminator a true, dicendo così ad Nhibernate di specificare sempre la where del discriminator nelle proprie query, come mostrato dal seguente mapping:</p>

<pre class="brush: xml; ruler: true;">&lt;discriminator force=&quot;true&quot;&gt;
  &lt;column name=&quot;Discriminator&quot; not-null=&quot;true&quot;  sql-type=&quot;int&quot; /&gt;
&lt;/discriminator&gt;</pre>

<p>In allegato potete trovare un esempio che riproduce il problema. 
  <br />Maggiori informazioni ed aggiornamenti potete trovarli <a href="http://nhjira.koah.net/browse/NH-1674?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel" target="_blank">qui</a>.</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:fb3a1972-4489-4e52-abe7-25a00bb07fdf:8995c0d4-fb02-4d0b-87fb-1cbe74d53c10" class="wlWriterEditableSmartContent"><p>Download Esempio <a href="http://imperugo.tostring.it/Content/Uploaded/image/imperugo.blog.sample.nhibernate.zip" target="_blank">qui</a></p></div>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/2009/05/15/loutputcache-su-mvc-view-user-control/" itemprop="url">L'OutputCache su MVC View User Control</a></h1>
	<div class="meta">
	<span class="date">



  


<time datetime="2009-05-15T01:39:24Z"  itemprop="datePublished">May 15, 2009</time></span>
	<span class="categories">asp.net</span>
	
		
  


<span class="comments"><a href="/2009/05/15/loutputcache-su-mvc-view-user-control/#disqus_thread">comments</a></span>
	
	<span class="edit">
  


<a href="https://github.com/gioffy/gioffy.github.io/edit/gh-pages/_posts/2009-05-15-loutputcache-su-mvc-view-user-control.markdown">edit</a>
</span>
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Personalmente faccio parecchio uso dell'<strong>OutputCache</strong>, e lo ritengo uno dei migliori sistemi di caching (in ambienti non distribuiti) che si possano utilizzare: il vantaggio consiste nel fatto che viene messo in cache il markup gi&agrave; elaborato, tagliando di netto dall'applicazione tutta la parte di elaborazione dati necessaria alla creazione della pagina, o una sua porzione; in pratica &egrave; come avere un file statico in ram!</p>

<p>Nella maggior parte dei casi non &egrave; possibile utilizzare l'<strong>OutputCache</strong> sull'intera pagina web in quanto questa pu&ograve; contenere informazioni differenti da utente a utente, come delle porzioni di pagine visibili solo ad alcuni ruoli o la maschera di login nel caso l'utente non sia loggato; <br />
&egrave; comunque sicuramente vantaggioso utilizzare l'outputcache su porzioni di pagine (usercontrol). <br />
In <a target="_blank" href="http://www.asp.net/mvc">ASP.NET MVC</a> ho avuto problemi nell'adottare questa tecnica in quanto, per renderizzare lo usercontrol, utilizzavo il metodo <strong>RenderPartial</strong>, che ignora totalmente l'attributo <strong>OutputCache</strong> . <br />
Da quanto invece apprendo dal blog di <a target="_blank" href="http://haacked.com/">Phil Haack</a>&nbsp;(maggiori info <a target="_blank" href="http://haacked.com/archive/2009/05/12/donut-hole-caching.aspx">qui</a>), risulta che &egrave; comunque possibile risolvere tale problema sostituendo l'utilizzo del <strong>RenderPartial</strong> ed andando a registrare il controllo, utilizzandolo cos&igrave; tramite il suo tag, come mostrato dal blocco di codice seguente:</p>

<pre class="brush: xml; ruler: true;">
&lt;%@ Register Src=&quot;~/Views/Home/Partial.ascx&quot; TagName=&quot;Partial&quot; TagPrefix=&quot;imperugo&quot; %&gt;

&lt;p&gt;
    Metodo con Registrazione del tag
    &lt;imperugo:Partial runat=&quot;server&quot; /&gt;
&lt;/p&gt;</pre>

<p>In allegato trovate un progetto che mostra lo stesso <strong>MVC View User Control</strong> utilizzato con le due metodologie, e, al refresh della pagina, si potr&agrave; notare la differenza di comportamento.</p>

<p>Ciauz</p>

<div id="scid:fb3a1972-4489-4e52-abe7-25a00bb07fdf:31e2a09a-6af0-42f5-b161-b6b1ee340386" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<p>Download Esempio <a target="_blank" href="http://imperugo.tostring.it/Content/Uploaded/image/imperugo.sample.mvc.outputcache.zip">qui</a></p>
</div>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/2009/05/11/il-tempdataprovider-di-asp-net-mvc/" itemprop="url">Il TempDataProvider di ASP.NET MVC</a></h1>
	<div class="meta">
	<span class="date">



  


<time datetime="2009-05-11T04:51:23Z"  itemprop="datePublished">May 11, 2009</time></span>
	<span class="categories">asp.net</span>
	
		
  


<span class="comments"><a href="/2009/05/11/il-tempdataprovider-di-asp-net-mvc/#disqus_thread">comments</a></span>
	
	<span class="edit">
  


<a href="https://github.com/gioffy/gioffy.github.io/edit/gh-pages/_posts/2009-05-11-il-tempdataprovider-di-asp-net-mvc.markdown">edit</a>
</span>
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Con il Framework <a target="_blank" href="http://www.asp.net/mvc">ASP.NET MVC</a> &egrave; stato introdotto il <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.controller.tempdataprovider.aspx">TempDataProvider</a> che, come fa ben intuire il suo nome, ha lo scopo di memorizzare delle informazioni temporanee tra una chiamata e la successiva. Infatti, se si prova ad immaginare un ciclo di navigazione di tre pagine (A,B e C), dalla pagina C non si pu&ograve; accedere alle informazioni aggiunte al <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.controller.tempdataprovider.aspx">TempDataProvider</a> della pagina A, ma solo a quelle della pagina B.</p>

<p>Di default queste informazioni vengono memorizzate nella <strong>Session</strong> e, anche se il <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.controller.tempdataprovider.aspx">TempDataProvider</a> non viene utilizzato, se si prova a disabilitare la Sessione tramite l&rsquo;apposita riga del file di configurazione, verr&agrave; sollevato un&rsquo;errore dall&rsquo;applicazione tipo il seguente:</p>

<blockquote>
<p><i>The SessionStateTempDataProvider requires SessionState to be enabled.</i></p>
</blockquote>

<p>Questo avviene perch&egrave;, all&rsquo;interno della classe <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.controller.aspx">Controller</a> (<strong>System.Web.Mvc.Controller</strong>) nel metodo <strong>Get</strong>, viene restituita (nel caso non fosse stato impostato un TempDataProvider differente) un&rsquo;istanza della classe <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.sessionstatetempdataprovider.aspx">SessionStateTempDataProvider</a>, e ne verr&agrave; invocato il <strong>metodo</strong> Load all&rsquo;interno del metodo ExecuteCore del Controller.</p>

<p>Per capirne meglio il funzionamento basta guardare lo snippet seguente:</p>

<pre class="brush: csharp; ruler: true;">
public ITempDataProvider TempDataProvider
{
     get
     {
         if (this._tempDataProvider == null)
         {
           this._tempDataProvider = new SessionStateTempDataProvider();
         }

         return this._tempDataProvider;
     }
     set
     {
         this._tempDataProvider = value;
     }
}
protected override void ExecuteCore()
{
  base.TempData.Load(base.ControllerContext, this.TempDataProvider);

  //&hellip;
}</pre>

<p>Se si ha la fortuna (o sfortuna, in base ai punti di vista) di sviluppare applicazioni che hanno come requisito il funzionamento in una server farm, la sessione non pu&ograve; essere utilizzata (salvo uso di frameowrk particolari), ed il provider deve essere sostituito con qualcosa di pi&ugrave; estensibile.</p>

<p>Per poter rispettare il requisito &egrave; necessario impostare un <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.controller.tempdataprovider.aspx">TempDataProvider</a> nel metodo <strong>Inizialize</strong> del <strong>Controller</strong> con una classe sostitutiva, come mostrato di seguito:</p>

<pre class="brush: csharp; ruler: true;">
protected override void Initialize(RequestContext requestContext)
{
  TempDataProvider = new CookieTempDataProvider(requestContext.HttpContext);
  base.Initialize(requestContext);
}</pre>

<p>Il custom provider dovr&agrave; implementare l&rsquo;interfaccia <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.itempdataprovider.aspx">ITempDataProvider</a> che richiede i seguenti metodi:</p>

<ul>
    <li><strong>LoadTempData</strong>;</li>
    <li><strong>SaveTempData</strong>;</li>
</ul>

<p>Il primo verr&agrave; invocato nel momento in cui si vogliono recuperare delle informazioni dal repository, il secondo quando si vogliono aggiungere delle informazioni al repository. <br />
Se non si ha la necessit&agrave; di memorizzare grandi quantit&agrave; di informazioni nel <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.controller.tempdataprovider.aspx">TempDataProvider</a>, sicuramente pu&ograve; essere utile memorizzarle in un cookie. <br />
Di fatto, su <a target="_blank" href="http://www.codeplex.com/">codeplex</a> nelle <strong>ASP.NET MVC Futures</strong>, si trova un&rsquo;implementazione di un <a target="_blank" href="http://msdn.microsoft.com/en-us/library/system.web.mvc.controller.tempdataprovider.aspx">TempDataProvider</a> che utilizza proprio il cookie come repository (maggiori info qui: <a href="http://aspnet.codeplex.com/SourceControl/changeset/view/21528#266402">http://aspnet.codeplex.com/SourceControl/changeset/view/21528#266402</a>).</p>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/2009/05/07/realizzare-un-actionfilter-per-ottimizzare-le-nostre-pagine-web/" itemprop="url">Realizzare un ActionFilter per ottimizzare le nostre pagine web.</a></h1>
	<div class="meta">
	<span class="date">



  


<time datetime="2009-05-07T07:19:01Z"  itemprop="datePublished">May  7, 2009</time></span>
	<span class="categories">asp.net</span>
	
		
  


<span class="comments"><a href="/2009/05/07/realizzare-un-actionfilter-per-ottimizzare-le-nostre-pagine-web/#disqus_thread">comments</a></span>
	
	<span class="edit">
  


<a href="https://github.com/gioffy/gioffy.github.io/edit/gh-pages/_posts/2009-05-07-realizzare-un-actionfilter-per-ottimizzare-le-nostre-pagine-web.markdown">edit</a>
</span>
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Fin dalla Preview 2 del Framework <a target="_blank" href="http://www.asp.net/mvc">ASP.NET MVC</a> sono stati introdotti gli <a target="_blank" href="http://msdn.microsoft.com/en-us/library/dd410209.aspx">ActionFilter</a>, che permettono di variare o migliorare il comportamento di un <strong>Controller </strong>o della singola <strong>Action </strong>in esso contenuta, consentendo cos&igrave; un forte riutilizzo del codice. <br />
Il loro utilizzo &egrave; piuttosto semplice: basta decorare la Action o il Controller con l'attributo e implementare la logica nei metodi esposti dall'ActionFilter base da cui tutti ereditano. <br />
I metodi messi a disposizione sono 4:</p>

<ul>
    <li><strong>OnActionExecuted</strong>;</li>
    <li><strong>OnActionExecuting</strong>;</li>
    <li><strong>OnResultExecuted</strong>;</li>
    <li><strong>OnResultExecuting</strong>;</li>
</ul>

<p><br />
Per capire pi&ugrave; a fondo le potenzialit&agrave; e semplicit&agrave; di utilizzo di questi ActionFilter ci basti osservare lo snippet seguente che abilita l&rsquo;accesso alla Action soltato agli utenti presenti nel ruolo di Administrator.</p>

<pre class="brush: csharp; ruler: true;">
[Authorize(Roles = &quot;Administrator&quot;)]
public ActionResult Index()
{
    //Nostra Action
}</pre>

<p>Ovviamente nel Framework troviamo gi&agrave; parecchi ActionFilter come HandleError, OutputCache, Authorize, ecc, ma spesso non tutti riescono a soddisfare esigenze quali, ad esempio, l'abilitazione della compressione sulle pagine, la rimozione di spazi vuoti dal markup o l'aggiunta di una firma a fondo pagina. <br />
Proprio dall'esigenza di rimuovere gli spazi vuoti &egrave; nata l'idea di realizzare un custom ActionFilter, che nel nostro esempio si chiamer&agrave; OptimizationFilter, che avr&agrave; il compito di ottimizzare la nostra pagina.</p>

<p>I requisiti per un filter di questo genere sono abbastanza semplici:</p>

<ul>
    <li>Possibilit&agrave; di attivare la compressione dei dati;</li>
    <li>Possibilit&agrave; di rimuovere gli spazi vuoti dal markup;</li>
    <li>Possibilit&agrave; di ignorare l'esecuzione del filtro per tutti gli utenti presenti in un determinato ruolo;</li>
</ul>

<p>Precedentemente in <a target="_blank" href="http://www.asp.net">ASP.NET</a>, per la rimozione degli spazi vuoti dal markup veniva realizzato un HttpModule, che aveva il compito di verificare se la richiesta effettuata era rivolta verso una pagina web, e, nel caso, eseguiva una Regular Expression per la rimozione degli spazi (maggiori info qui: <a target="_blank" href="http://madskristensen.net/post/A-whitespace-removal-HTTP-module-for-ASPNET-20.aspx">http://madskristensen.net/post/A-whitespace-removal-HTTP-module-for-ASPNET-20.aspx)</a>. <br />
Purtroppo, bench&egrave; comodissime, le Regular Expression non brillano sicuramente per le performance, quindi consiglio di abbinare l'outputcache all'utilizzo di questo ActionFilter.</p>

<p>Partendo da quanto mostrato in questo post (<a target="_blank" href="http://madskristensen.net/post/The-WebOptimizer-class.aspx">http://madskristensen.net/post/The-WebOptimizer-class.aspx)</a> di <a target="_blank" href="http://madskristensen.net/">Mads Kristensen</a>, ho implementato il CustomFilter come mostrato di seguito:</p>

<pre class="brush: csharp; ruler: true;">
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, Inherited = true, AllowMultiple = false)]
[AspNetHostingPermission(SecurityAction.Demand, Level = AspNetHostingPermissionLevel.Minimal)]
public class OptimizationFilter : ActionFilterAttribute
{
    private bool? executeUser;
    private string[] rolesException;

    public OptimizationFilter()
    {
        Compress = false;
        RemoveWhiteSpace = false;
    }

    public bool Compress { get; set; }
    public bool RemoveWhiteSpace { get; set; }

    public string RolesException
    {
        get { return string.Join(&quot;,&quot;, rolesException); }
        set { rolesException = value.Split(&quot;,&quot;); }
    }

    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        bool execute = Execute(filterContext);

        if (!execute)
            return;

        if (!Compress)
            base.OnActionExecuting(filterContext);

        HttpRequestBase request = filterContext.HttpContext.Request;

        string acceptEncoding = request.Headers[&quot;Accept-Encoding&quot;];

        if (string.IsNullOrEmpty(acceptEncoding))
            return;

        acceptEncoding = acceptEncoding.ToUpperInvariant();

        HttpResponseBase response = filterContext.HttpContext.Response;

        if (acceptEncoding.Contains(&quot;GZIP&quot;))
        {
            response.AppendHeader(&quot;Content-encoding&quot;, &quot;gzip&quot;);
            response.Filter = new GZipStream(response.Filter, CompressionMode.Compress);
        }
        else if (acceptEncoding.Contains(&quot;DEFLATE&quot;))
        {
            response.AppendHeader(&quot;Content-encoding&quot;, &quot;deflate&quot;);
            response.Filter = new DeflateStream(response.Filter, CompressionMode.Compress);
        }
    }

    private bool Execute(ControllerContext filterContext)
    {
        bool execute = true;

        if (rolesException == null)
            executeUser = true;

        if (executeUser != null)
            return executeUser.Value;

        for (int i = 0; i &lt; rolesException.Length; i++)
            if (filterContext.HttpContext.User.IsInRole(rolesException[i]))
            {
                execute = false;
                break;
            }

        executeUser = execute;

        return execute;
    }

    public override void OnResultExecuted(ResultExecutedContext filterContext)
    {
        base.OnResultExecuted(filterContext);

        if (!Execute(filterContext))
            return;

        if (RemoveWhiteSpace)
            filterContext.HttpContext.Response.Filter = new WhitespaceFilter(filterContext.HttpContext.Response.Filter);
    }
}

internal class WhitespaceFilter : Stream
{
    private static readonly Regex RegexBetweenTags = new Regex(@&quot;&gt;\s+&lt;&quot;, RegexOptions.Compiled);
    private static readonly Regex RegexLineBreaks = new Regex(@&quot;\n\s+&quot;, RegexOptions.Compiled);

    private readonly Stream sink;

    public WhitespaceFilter(Stream sink)
    {
        this.sink = sink;
    }

    public override void Flush()
    {
        sink.Flush();
    }

    public override long Seek(long offset, SeekOrigin origin)
    {
        return sink.Seek(offset, origin);
    }

    public override void SetLength(long value)
    {
        sink.SetLength(value);
    }

    public override void Close()
    {
        sink.Close();
    }

    public override int Read(byte[] buffer, int offset, int count)
    {
        return sink.Read(buffer, offset, count);
    }

    public override void Write(byte[] buffer, int offset, int count)
    {
        var data = new byte[count];
        Buffer.BlockCopy(buffer, offset, data, 0, count);
        string html = Encoding.Default.GetString(buffer);


        html = RegexBetweenTags.Replace(html, &quot;&gt; &lt;&quot;);
        html = RegexLineBreaks.Replace(html, string.Empty);
        html = html.Replace(&quot;\r&quot;, string.Empty);
        html = html.Replace(&quot;//&lt;![CDATA[&quot;, string.Empty);
        html = html.Replace(&quot;//]]&gt;&quot;, string.Empty);
        html = html.Replace(&quot;\n&quot;, string.Empty); 

        byte[] outdata = Encoding.Default.GetBytes(html.Trim());
        sink.Write(outdata, 0, outdata.GetLength(0));
    }

    public override bool CanRead
    {
        get { return true; }
    }

    public override bool CanSeek
    {
        get { return true; }
    }

    public override bool CanWrite
    {
        get { return true; }
    }

    public override long Length
    {
        get { return 0; }
    }

    public override long Position { get; set; }
}</pre>

<p>Come si potr&agrave; notare, l&rsquo; ActionFilter ha esposte tre propriet&agrave;:</p>

<ul>
    <li><strong>Compress; </strong></li>
    <li><strong>RemoveWhiteSpace; </strong></li>
    <li><strong>RolesException; </strong></li>
</ul>

<p>La prima serve per impostare la compressione, la seconda a rimuovere gli spazi vuoti dal markup e la terza per disabilitare le prime solo ad alcuni ruoli; proprio quest'ultima si pu&ograve; rivelare molto utile nel caso si debbano effettuare controlli sul markup. <br />
Come si pu&ograve; vedere dallo snippet seguente il suo utilizzo risulta molto semplice.</p>

<pre class="brush: csharp; ruler: true;">
[OptimizationFilter(Compress = false, RemoveWhiteSpace = true, RolesException = &quot;CSSDesigner,MarkupDesigner&quot;)]
public ActionResult Index(string page)
{
    //Nostra Action
}</pre>

<p>Ulteriori informazioni riguardo agli Action Filter le potete trovare <a target="_blank" href="http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx">qui</a>.</p>

<p>Ciauz</p>

		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/43" class="prev">Prev</a>
    
    
        <a href="/page/45" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Giorgio Formica Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a> | <a href="/privacy">privacy</a> | <a href="/articles/blogtegrity">blogtegrity</a>
</p>
<img id="feedburner-count" src="http://feedproxy.google.com/~fc/imperugo?bg=FFFFFF&amp;fg=999999&amp;anim=0" alt="Reader count" />

  

<script type="text/javascript">
      var disqus_shortname = 'it-tostring';
      
    (function () {
    
      var countScript = document.createElement('script');
      countScript.type = 'text/javascript';
      countScript.async = true;
      countScript.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(countScript);
    }());
</script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</footer>
		</div>
	</div>


<!--  CodeProject AD  -->
<script>
    function _dmBootstrap(file) {
        var _dma = document.createElement('script'); 
        _dma.type = 'text/javascript';
        _dma.async = true; 
        _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + file;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
    }
    function _dmFollowup(file) { if (typeof DMAds === 'undefined')  _dmBootstrap('cdn2.DeveloperMedia.com/a.min.js');}
    (function () { _dmBootstrap('cdn1.DeveloperMedia.com/a.min.js'); setTimeout(_dmFollowup, 2000);})();
</script>
</body>
</html>
